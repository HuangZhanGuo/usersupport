<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.facebank.usersupport.attendance.mapper.AdjustRestMapper">

    <!--添加调休申请记录-->
    <insert id="saveRestApply" parameterType="com.facebank.usersupport.attendance.model.ApplyRecordModel">
        <selectKey resultType="java.lang.Long" order="AFTER" keyProperty="id">
            SELECT LAST_INSERT_ID()
        </selectKey>
        INSERT INTO apply_record (work_number,emp_name,start_time,end_time,apply_date,apply_duration,apply_cause,apply_type,status)
        VALUES (#{workNumber},#{empName},#{startTime},#{endTime},#{applyDate},#{applyDuration},#{applyCause},#{applyType},#{status})
    </insert>

    <resultMap id="restApplyResult" type="com.facebank.usersupport.attendance.model.ApplyRecordModel">
        <id column="id" property="id"/>
        <result column="work_number" property="workNumber"/>
        <result column="emp_name" property="empName"/>
        <result column="start_time" property="startTime"/>
        <result column="end_time" property="endTime"/>
        <result column="apply_date" property="applyDate"/>
        <result column="apply_duration" property="applyDuration"/>
        <result column="apply_cause" property="applyCause"/>
        <result column="apply_type" property="applyType"/>
        <result column="status" property="status"/>
        <result column="notpass_cause" property="notpassCause"/>
    </resultMap>

    <!--根据queryVo查询调休申请记录-->
    <select id="getRestApplyListByQueryVo" parameterType="com.facebank.usersupport.attendance.dto.reqDto.QueryVo" resultMap="restApplyResult">
        SELECT
            id,
            work_number,
            emp_name,
            start_time,
            end_time,
            apply_date,
            apply_duration,
            apply_cause,
            apply_type,
            status,
            notpass_cause
        FROM apply_record
        <where>
            <if test="workNumber != null and workNumber != ''">
                work_number = #{workNumber}
            </if>
            <if test="dateStartTime != null and dateStartTime != ''">
                AND apply_date &gt;= #{dateStartTime}
            </if>
            <if test="dateEndTime != null and dateEndTime != ''">
                AND apply_date &lt;= #{dateEndTime}
            </if>
        </where>
        ORDER BY apply_date DESC
    </select>

    <update id="updateRestApply" parameterType="com.facebank.usersupport.attendance.model.ApplyRecordModel">
        UPDATE apply_record SET start_time = #{startTime},end_time = #{endTime},apply_duration = #{applyDuration},apply_cause = #{applyCause}
        WHERE id = #{id}
    </update>

</mapper>