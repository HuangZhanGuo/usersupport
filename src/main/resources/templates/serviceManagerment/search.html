<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:include="common/head_info::head_infor"></div>
    <script type="text/javascript" th:src="@{../js/moment-with-locales.min.js}"></script>
    <script type="text/javascript" th:src="@{../js/bootstrap-datetimepicker.js}"></script>
    <script type="text/javascript" th:src="@{../js/bootstrap-datetimepicker.zh-CN.js}"></script>
    <link rel="stylesheet" type="text/css" th:href="@{../css/bootstrap-datetimepicker.css}">

    <form class="form-inline" id="repaymentForm">
        <div class="form-group">
            <label for="userId">用户ID</label>
            <input type="text" class="form-control" id="userId" name="userId" placeholder="用户ID">
        </div>
        <div class="form-group">
            <label for="orderId">订单ID</label>
            <input type="email" class="form-control" id="orderId" name="orderId" placeholder="订单ID">
        </div>
        <!--<div class="form-group">
                             <label for="datetimeStart">还款日期</label>
                             <input size="16" type="text" id="datetimeStart" readonly class="form_datetime">
                         </div>-->
        <div class="form-group">
            <label class="labe_l">还款日期:</label>
            <input type="text" class="form_datetime" id="datetimeStart" name="startTime" readonly>
            --
            <input type="text" class="form_datetime" id="datetimeEnd" name="endTime" readonly>

        </div>
        <span class="btn btn-default" onclick="search()" >查询</span>
    </form>

    <script type="text/javascript">
        function search(){
            var dateStart = $("#datetimeStart").val();
            var dateEnd = $("#datetimeEnd").val();
            var startTime = null;
            var endTime = null;
            if(dateStart != null && dateStart != ""){
                startTime = new Date(dateStart).getTime();
            }
            if(dateEnd != null && dateEnd != ""){
                endTime = new Date(dateEnd).getTime();
            }
            /*$("#datetimeStart").val(startTime);
            $("#datetimeEnd").val(endTime);*/
            var userId = $("#userId").val();
            var orderId = $("#orderId").val();

            $.ajax({
                url : "/service/repayment",
                type : "post",
                data : /*$("#repaymentForm").serialize()*/{userId:userId,orderId:orderId,startTime:startTime,endTime:endTime},
                dataType : "json",
                success : function(result) {
                    console.log(result);
                    var tbody = window.document.getElementById("repaymentData");
                    var datas=result.data;
                    console.log(datas);
                    var str="";
                    for (i in datas) {
                        str += "<tr>" +
                            "<td>" + datas[i].credOrderId + "</td>" +
                            "<td>" + datas[i].credUserId + "</td>" +
                            "<td>" + datas[i].credPlanPrincipal + "</td>" +
                            "<td>" + datas[i].credPlanInterest + "</td>" +
                            "<td>" + datas[i].credPlanDate + "</td>" +
                            "<td>";
                        if(datas[i].redLocalInfo != null && datas[i].redLocalInfo != ""){
                            str += datas[i].redLocalInfo['"model_name"'];
                        }else{
                            str += "";
                        }
                        str += "</td>" +
                            "<td>" + datas[i].redPlanAmount + "</td>" +
                            "<td>";
                        if(datas[i].redPackageType == 1000){
                            str += "加息红包";
                        }else if(datas[i].redPackageType == 1010){
                            str += "返现红包";
                        }else{
                            str += "";
                        }
                        str += "</td>" +
                            "<td>" + datas[i].redTermNum + "</td>" +
                            "<td>" + datas[i].vipRate + "</td>" +
                            "<td>" + datas[i].vipPlanAmount + "</td>" +
                            "<td>" + datas[i].vipTermNum + "</td>" +
                            "<td>" + datas[i].pfPlanAmount + "</td>" +
                            "<td>" + datas[i].pfTermNum + "</td>" +
                            "<td>";
                        if(datas[i].pfType == 100){
                            str += "首购加息";
                        }else if(datas[i].pfType == 200){
                            str += "限时加息";
                        }else if(datas[i].pfType == 300){
                            str += "项目加息";
                        }else{
                            str += "";
                        }
                        str += "</td>" +
                            "</tr>";
                        console.log(str);
                    }
                    tbody.innerHTML = str;
                }
            })
        }
    </script>

    <form>
        <div class="row">
            <div class="col-lg-5">
                <div class="panel panel-default" style="width:100%;overflow:auto">
                    <div class="panel-heading">客户信息列表</div>
                    <table class="table table-bordered table-striped" align="center" >
                        <thead>
                        <tr>
                            <th>订单ID</th>
                            <th>用户ID</th>
                            <th>债权计划本金</th>
                            <th>计划利息</th>
                            <th>计划时间</th>
                            <th>红包信息</th>
                            <th>红包金额</th>
                            <th>加息红包/返现红包</th>
                            <th>红包期限</th>
                            <th>vip利率</th>
                            <th>vip收益</th>
                            <th>vip期数</th>
                            <th>加息金额</th>
                            <th>加息期数</th>
                            <th>首购加息/限时加息/项目加息</th>
                        </tr>
                        </thead>
                        <tbody id="repaymentData">
                        </tbody>
                    </table>
                    <div class="col-md-12 text-right">
                    </div>
                </div>
            </div>
        </div>
        </div>
    </form>
    <script type="text/javascript">
        //日期插件初始化
        $('#datetimeStart').datetimepicker({
            language:  'zh-CN',
            // format:'yyyy-mm-dd',
            format:'yyyy-mm-dd hh:ii',
            weekStart: 1, /*以星期一为一星期开始*/
            todayBtn:  1,
            autoclose: 1,
            // minView:2, /*精确到天*/
            todayHighlight: 1,
            startView: 2,
            forceParse: 0,
            showMeridian: 1,
            pickerPosition: "bottom-left"
        }).on("changeDate",function(ev){  //值改变事件
            //选择的日期不能大于第二个日期控件的日期
            if(ev.date){
                $("#datetimeEnd").datetimepicker('setStartDate', new Date(ev.date.valueOf()));
            }else{
                $("#datetimeEnd").datetimepicker('setStartDate',null);
            }
        });
        $('#datetimeEnd').datetimepicker({
            language:  'zh-CN',
            format:'yyyy-mm-dd hh:ii',
            weekStart: 1, /*以星期一为一星期开始*/
            todayBtn:  1,
            autoclose: 1,
            // minView:2, /*精确到天*/
            todayHighlight: 1,
            startView: 2,
            forceParse: 0,
            showMeridian: 1,
            pickerPosition: "bottom-left"
        }).on("changeDate",function(ev){
            /*选择的日期不能小于第一个日期控件的日期*/
            if(ev.date){
                $("#datetimeStart").datetimepicker('setEndDate', new Date(ev.date.valueOf()));
            }else{
                $("#datetimeStart").datetimepicker('setEndDate',new Date());
            }
        });
    </script>

</html>