<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:include="common/head_info::head_infor"></div>
    <script type="text/javascript" th:src="@{../js/paging.js}"></script>
    <script type="text/javascript" th:src="@{../js/My97DatePicker/WdatePicker.js}"></script>
    <script type="text/javascript" th:src="@{../js/dateFormat.js}"></script>
    <link rel="stylesheet" type="text/css" th:href="@{../css/paging.css}">
</head>
<body>
<div class="container center" style="width: 100%;">
    <form class="navbar-form navbar-left" role="search">
        <div class="form-group">
            <input type="text" name="mobile" class="form-control" placeholder="手机号">
            <select class="form-control " id="type" name="type">
                <option value="">所有类型</option>
                <option value="1">汇入</option>
                <option value="2">汇出</option>
            </select>
            <input id="datetimeStart" class="Wdate" type="text" onclick="WdatePicker({dateFmt:'yyyy-M-d H:mm:ss',skin:'whyGreen',maxDate:'%y-%M-%d'})"/>
            --
            <input id="datetimeEnd" class="Wdate" type="text" onclick="WdatePicker({dateFmt:'yyyy-M-d H:mm:ss',skin:'whyGreen',maxDate:'%y-%M-%d'})"/>
        </div>
        <button type="button" class="btn btn-default" id="moneyRecordSearch">查找</button>
    </form>
    <div class="panel panel-default" style="width:100%;height:auto;overflow:auto;">
        <!-- Table -->
        <table class="table table-bordered table-striped" style="min-width:1020px;word-break: keep-all;">
            <thead>
            <tr>
                <th width="80px">id</th>
                <th width="80px">资金汇入者id</th>
                <th width="80px">资金汇入者的昵称</th>
                <th width="80px">资金汇出者id</th>
                <th width="80px">资金汇出者的昵称</th>
                <th width="80px">资金汇出者的昵称</th>
                <th width="80px">此交易完成后的账户余额</th>
                <th width="80px">资金来往类型</th>
                <th width="80px">交易发生时间</th>
                <th width="80px">交易渠道</th>
                <th width="80px">交易备注</th>
                <th width="80px">关联的loanId</th>
                <th width="80px">借款标题</th>
                <th width="80px">标头像图片的路径</th>
                <th width="80px">外部序列号</th>
            </tr>
            </thead>
            <tbody class="table table-bordered table-striped" style="word-break: keep-all" id="moneyRecordList"></tbody>
        </table>
    </div>
    <div id="pageing"></div>
</div>
<script>
    $(function(){

        var today = new Date();
        today.setHours(0);
        today.setMinutes(0);
        today.setSeconds(0);
        today.setMilliseconds(0);

        $("#datetimeStart").val(Format(today,"yyyy-MM-dd HH:mm:ss"));
        $("#datetimeEnd").val(Format(new Date(),"yyyy-MM-dd HH:mm:ss"));
    });
    var counts = 6;
    //查询
    $('#moneyRecordSearch').click(function () {
        getPageAttribute(1,counts);
    });

    function getPageAttribute(page, couts) {
        $.ajax({
            url: "/money/getMoneyRecordPage",
            type: "POST",
            dataType: "json",
            data: {
                mobile: $('[name="mobile"]').val(),
                type: $('[name="type"]').val(),
                starttime: new Date($('#datetimeStart').val()).getTime(),
                endtime: new Date($('#datetimeEnd').val()).getTime(),
                page: page,
                couts: couts
            },
            success: function (json) {
                if (json.code == 202) {
                    alert(json.message)
                }
                if (json.code == 203) {
                    alert(json.message)
                }
                if (json.code == 204) {
                    alert(json.message)
                }
                if (json.code == 200) {
                    if (json.data.list == null || json.data.list == "") {
                        alert("无数据。")
                    }
                    createPageNav({
                        $container: $("#pageing"),
                        pageCount: json.data.pages,
                        currentNum: json.data.pageNum,
                        afterFun: function (num) {
                            getPageAttribute(num, couts);
                        },
                        hasCommonPage: false
                    });
                    var str = "";
                    for (var i = 0; i < json.data.list.length; i++) {
                        var id = json.data.list[i].id;
                        var touserid = json.data.list[i].touserid;
                        var tousernickname = json.data.list[i].tousernickname;
                        var fromuserid = json.data.list[i].fromuserid;
                        var fromusernickname = json.data.list[i].fromusernickname;
                        var amount = json.data.list[i].amount;
                        var accountbalance = json.data.list[i].accountbalance;
                        var tradetype = json.data.list[i].tradetype;
                        if(tradetype>=1000){tradetype = "汇出";}
                        if(tradetype<1000){tradetype = "汇入";}
                        var tradetime = json.data.list[i].tradetime;
                        var tradechannel = json.data.list[i].tradechannel;
                        var tradecomment = json.data.list[i].tradecomment;
                        var loanid = json.data.list[i].loanid;
                        var loantitle = json.data.list[i].loantitle;
                        var loanportraitpath = json.data.list[i].loanportraitpath;
                        var outserialno = json.data.list[i].outserialno;
                        //为空转换
                        if (id == null) {
                            id = "";
                        }
                        if (touserid == null) {
                            touserid = "";
                        }
                        if (tousernickname == null) {
                            tousernickname = "";
                        }
                        if (fromuserid == null) {
                            fromuserid = "";
                        }
                        if (fromusernickname == null) {
                            fromusernickname = "";
                        }
                        if (amount == null) {
                            amount = "";
                        }
                        if (accountbalance == null) {
                            accountbalance = "";
                        }
                        if (tradetype == null) {
                            tradetype = "";
                        }
                        if (tradetime == null) {
                            tradetime = "";
                        }
                        if (tradechannel == null) {
                            tradechannel = "";
                        }
                        if (tradecomment == null) {
                            tradecomment = "";
                        }
                        if (loanid == null) {
                            loanid = "";
                        }
                        if (loantitle == null) {
                            loantitle = "";
                        }
                        if (loanportraitpath == null) {
                            loanportraitpath = "";
                        }
                        if (outserialno == null) {
                            outserialno = "";
                        }
                        str += '<tr>'
                            + '<th>' + id + '</th>'
                            + '<th>' + touserid + '</th>'
                            + '<th>' + tousernickname + '</th>'
                            + '<th>' + fromuserid + '</th>'
                            + '<th>' + fromusernickname + '</th>'
                            + '<th>' + amount + '</th>'
                            + '<th>' + accountbalance + '</th>'
                            + '<th>' + tradetype + '</th>'
                            + '<th>' + formatDate(tradetime) + '</th>'
                            + '<th>' + tradechannel + '</th>'
                            + '<th>' + tradecomment + '</th>'
                            + '<th>' + loanid + '</th>'
                            + '<th>' + loantitle + '</th>'
                            + '<th>' + loanportraitpath + '</th>'
                            + '<th>' + outserialno + '</th>'
                            + '</tr>';
                    }
                    $('#moneyRecordList').html(str);
                }
            }
        })
    };


    //日期转换
    function formatDate(now) {
        if (now == "") {
            return "";
        }
        return new Date(now).toLocaleString();
    }
</script>
</body>
</html>